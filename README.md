# Каталог изображений

Проект для создания каталога изображений с возможностью поиска по описаниям и похожим изображениям. Использует LLM для генерации описаний и векторную базу данных для семантического поиска.

## Возможности

- Извлечение EXIF-данных из изображений
- Генерация подробных описаний изображений с помощью LLM (Ollama)
- Индексация изображений в SQLite базу данных
- Полнотекстовый поиск по описаниям
- Автоматическое изменение размера изображений для оптимизации

## Технологии

- Python 3.8+
- Ollama (локальная LLM)
- SQLite с FTS5
- FastAPI (в разработке)
- React (в разработке)

## Структура проекта

```
image-catalog/
├── describe_image.py     # Скрипт для генерации описаний изображений
├── extract_exif.py       # Скрипт для извлечения EXIF-данных
├── index_images.py       # Скрипт для индексации изображений
├── images.db            # База данных SQLite
├── logs/                # Каталог для логов и описаний
├── requirements.txt     # Зависимости проекта
└── README.md           # Документация
```

## Установка и настройка

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите Ollama локально:
```bash
ollama serve
```

4. Скачайте модель llava:
```bash
ollama pull llava
```

## Использование

### Генерация описания изображения

```bash
python describe_image.py путь/к/изображению.jpg [--max-size MAX_SIZE]
```

Параметры:
- `путь/к/изображению.jpg` - путь к изображению (обязательный)
- `--max-size` - максимальный размер большей стороны изображения в пикселях (по умолчанию: 1600)

Пример:
```bash
python describe_image.py DSCF3241.jpg --max-size 1200
```

Скрипт:
1. Изменяет размер изображения, сохраняя пропорции
2. Генерирует подробное описание с помощью Ollama
3. Сохраняет описание в JSON-файл в каталоге `logs/`
4. Выводит описание и метаданные в консоль

### Индексация изображений

```bash
python index_images.py путь/к/каталогу [--recursive] [--max-size MAX_SIZE]
```

Параметры:
- `путь/к/каталогу` - путь к каталогу с изображениями (обязательный)
- `--recursive` - рекурсивный обход подкаталогов
- `--max-size` - максимальный размер большей стороны изображения в пикселях (по умолчанию: 1600)

Пример:
```bash
python index_images.py ~/Pictures --recursive --max-size 1200
```

Скрипт:
1. Находит все изображения в указанном каталоге
2. Извлекает EXIF-данные
3. Генерирует описания с помощью Ollama
4. Сохраняет информацию в базу данных SQLite
5. Создает полнотекстовый индекс для поиска

### Просмотр списка изображений

```bash
python list_images.py [--db DB_PATH] [--limit LIMIT] [--offset OFFSET] [--search SEARCH]
```

Параметры:
- `--db` - путь к файлу базы данных (по умолчанию: images.db)
- `--limit` - максимальное количество записей для вывода
- `--offset` - смещение для пагинации (по умолчанию: 0)
- `--search` - поисковый запрос для фильтрации описаний

Примеры:
```bash
# Вывод всех изображений
python list_images.py

# Поиск по описанию
python list_images.py --search "sunset"

# Пагинация результатов
python list_images.py --limit 10 --offset 20
```

Скрипт:
1. Подключается к базе данных SQLite
2. Выполняет поиск по описаниям (если указан параметр --search)
3. Выводит информацию о каждом изображении:
   - Статус файла (✓ - существует, ✗ - отсутствует)
   - Путь к файлу
   - Дата индексации
   - Описание изображения

### База данных

База данных `images.db` содержит следующие таблицы:
- `images` - основная таблица с информацией об изображениях
- `images_fts` - виртуальная таблица для полнотекстового поиска

Схема таблицы `images`:
```sql
CREATE TABLE images (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_path TEXT UNIQUE,
    exif_json TEXT,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Логи и описания

Все логи и JSON-файлы с описаниями сохраняются в каталог `logs/`:
- `image_descriptions.log` - лог работы скриптов
- `*_description.json` - JSON-файлы с описаниями изображений

## Разработка

### Планируемые улучшения

1. Добавление веб-интерфейса на FastAPI + React
2. Реализация семантического поиска с помощью FAISS
3. Добавление поиска похожих изображений
4. Улучшение качества описаний
5. Добавление тегов и категорий

### Требования к окружению

- Python 3.8 или выше
- Ollama с моделью llava
- 8+ ГБ оперативной памяти
- 10+ ГБ свободного места на диске

