# Каталог изображений с поиском по описанию и векторным индексом

## О проекте

Этот проект предназначен для создания каталога изображений с возможностью поиска по текстовому описанию и семантическому сходству. Используются современные технологии обработки изображений, извлечения признаков, генерации описаний с помощью LLM (Ollama), а также векторный поиск через FAISS.

### Основные возможности
- Извлечение EXIF-метаданных из изображений
- Генерация подробных описаний изображений с помощью LLM (Ollama)
- Индексация изображений и описаний в базе данных SQLite
- Семантический поиск по описаниям с помощью FAISS и sentence-transformers
- Быстрый полнотекстовый поиск по описаниям (FTS5)

### Технологии
- Python 3.13+
- SQLite
- FAISS (векторный поиск)
- Sentence-Transformers (эмбеддинги)
- Ollama (LLM для генерации описаний)
- Pillow, exif, requests

## Структура проекта

```
image-catalog/
├── describe_image.py        # Генерация описания для одного изображения
├── extract_exif.py          # Извлечение EXIF-метаданных
├── index_images.py          # Индексация каталога изображений в SQLite
├── create_faiss_index.py    # Создание FAISS-индекса по описаниям
├── search_images.py         # Поиск по векторному индексу FAISS
├── requirements.txt         # Зависимости Python
├── README.md                # Описание проекта
├── .gitignore               # Исключения для git (images.db, image_index.faiss и др.)
├── images.db                # (игнорируется) База данных изображений
├── image_index.faiss        # (игнорируется) Векторный индекс FAISS
└── ...                      # Ваши изображения и другие файлы
```

## Быстрый старт

1. **Создайте и активируйте виртуальное окружение:**
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
2. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
3. **Запустите Ollama (LLM) в Docker:**
   ```bash
   docker run -d -p 11434:11434 --name ollama ollama/ollama
   docker exec -it ollama ollama pull llama3
   ```
   > Ollama должен быть доступен на http://localhost:11434

## Использование скриптов

### 1. Индексация изображений и генерация описаний

```bash
python index_images.py <путь_к_каталогу> [-r]
```
- Индексирует все изображения в каталоге, извлекает EXIF и генерирует описание через Ollama.
- Сохраняет данные в images.db.
- Если указан ключ `-r` (или `--recursive`), то выполняется рекурсивный обход всех подкаталогов.

### 2. Создание FAISS-индекса

```bash
python create_faiss_index.py
```
- Загружает описания из images.db
- Создаёт эмбеддинги с помощью sentence-transformers
- Строит и сохраняет векторный индекс в image_index.faiss

### 3. Поиск по описанию (семантический поиск)

```bash
python search_images.py "ваш поисковый запрос"
```
- Находит наиболее похожие изображения по смыслу запроса
- Выводит путь к файлу и краткое описание

### 4. Генерация описания для одного изображения

```bash
python describe_image.py <имя_файла>
```
- Получает подробное описание изображения через Ollama

### 5. Извлечение EXIF-метаданных

```bash
python extract_exif.py <имя_файла>
```
- Показывает EXIF-метаданные изображения

## Примечания
- Файлы images.db и image_index.faiss добавлены в .gitignore и не попадают в git-репозиторий.
- Для работы генерации описаний требуется запущенный Ollama (см. выше).
- Для FAISS-индексации требуется модель sentence-transformers (скачивается автоматически при первом запуске).

---

Если возникнут вопросы или потребуется расширить функционал — пишите! 